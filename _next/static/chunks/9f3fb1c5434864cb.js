(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20231,e=>{"use strict";e.s(["default",()=>g],20231);var t=e.i(43476),s=e.i(71645);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class a{move(e,t,s){let i=Math.hypot(e,t)||1;this.x+=e/i*this.speed*s,this.y+=t/i*this.speed*s}takeDamage(e,t){this.invul&&!(this.hp<=0)&&(this.hp=Math.max(0,this.hp-e),this.invul=!0,0===this.hp&&this.die())}die(){this.speed=0}constructor(e,t,s){i(this,"x",void 0),i(this,"y",void 0),i(this,"speed",void 0),i(this,"hp",100),i(this,"isPlayerFrozen",!1),i(this,"invul",!1),i(this,"inventory",[]),this.x=e,this.y=t,this.speed=s}}class r{update(e,t){let s=!!e.right-!!e.left,i=!!e.down-!!e.up;(s||i)&&this.player.move(s,i,t)}constructor(){i(this,"player",new a(721,300,225))}}var n=e.i(33901);let l=new n.Events.EventEmitter,o={up:!1,down:!1,left:!1,right:!1};var h=n;class p extends h.Scene{preload(){this.load.image("tiles","/assets/tiles/tuxmon-sample-32px-extruded.png"),this.load.tilemapTiledJSON("map","/assets/maps/tuxemon-town.json"),this.load.spritesheet("dude","/assets/sprites/dude.png",{frameWidth:32,frameHeight:48})}create(){!function(e){let t=e.make.tilemap({key:"map"});console.debug("map.tilesets:",t.tilesets.map(e=>e.name));let s=t.addTilesetImage("tuxmon-sample-32px-extruded","tiles");if(!s&&t.tilesets.length>0){let e=t.tilesets[0].name;console.warn("Tileset 'tuxmon-sample-32px' não encontrado no map.json — usando '".concat(e,"' como fallback")),s=t.addTilesetImage(e,"tiles")}if(!s)throw Error("Tileset não encontrado: verifique o nome do tileset no JSON e a chave do asset carregado.");if(e.belowLayer=t.createLayer("Below Player",s,0,0),e.worldLayer=t.createLayer("World",s,0,0),e.aboveLayer=t.createLayer("Above Player",s,0,0),e.worldLayer){if(!e.aboveLayer)throw Error("AboveLayer não retornado por map.createLayer")}else throw Error("WorldLayer não retornado por map.createLayer");e.aboveLayer.setDepth(10),e.worldLayer.setCollisionByProperty({collides:!0})}(this),this.setupPhysicsAndColliders(),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("dude",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"turn",frames:[{key:"dude",frame:4}],frameRate:20}),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("dude",{start:5,end:8}),frameRate:10,repeat:-1}),this.cursors=this.input.keyboard.createCursorKeys(),this.cameras.main.startFollow(this.player),this.cameras.main.setLerp(.15,.15),this.setupLife()}setupPhysicsAndColliders(){this.gs=new r,this.player=this.physics.add.sprite(this.gs.player.x,this.gs.player.y,"dude"),this.gs.player.x=this.player.x,this.gs.player.y=this.player.y,this.npc=this.physics.add.sprite(410,310,"assets","weirdsquare"),this.physics.add.collider(this.npc,this.worldLayer),this.physics.add.collider(this.player,this.npc,this.handleNpcCollision,void 0,this),this.physics.add.collider(this.player,this.worldLayer)}setupLife(){let e=this.gs.player.hp;l.emit("hp:update",e),this.time.addEvent({delay:1500,loop:!0,callback:()=>{this.gs.player.hp<=0&&!this.gs.player.isPlayerFrozen&&(this.freezePlayer("dead"),this.player.setTint(8947848),this.scene.launch("SpectatorUI",{main:this}),this.scene.bringToTop("SpectatorUI"))}})}handleNpcCollision(){this.gs.player.invul||(this.gs.player.hp-=25,l.emit("hp:update",this.gs.player.hp),console.log("O player tomou 25 de dano! Vida atual: ".concat(this.gs.player.hp)),this.gs.player.invul=!0,this.time.delayedCall(1e3,()=>this.gs.player.invul=!1),this.player.setTint(0xff0000),this.time.delayedCall(200,()=>this.player.clearTint()))}applyDamage(e){this.gs.player.hp=Math.max(0,this.gs.player.hp-e),l.emit("hp:update",this.gs.player.hp)}heal(e){this.gs.player.hp=Math.min(100,this.gs.player.hp+e),l.emit("hp:update",this.gs.player.hp)}freezePlayer(e){this.gs.player.isPlayerFrozen=!0,this.player.setVelocity(0,0),this.player.anims.play("turn"),this.player.body.enable=!1}update(e,t){if(this.updateAngryNpc(),this.gs.player.isPlayerFrozen)return void this.player.setVelocity(0,0);this.updatePlayer()}updatePlayer(){var e,t,s,i,a,r,n,l,h,p;if(!this.player||!this.player.body)return;let d=this.gs.player.speed;console.log("Essa é a velocidade:",d);let c=0,u=0;(null==(e=this.cursors.left)?void 0:e.isDown)||o.left?(c=-d,this.player.anims.play("left",!0)):(null==(t=this.cursors.right)?void 0:t.isDown)||o.right?(c=d,this.player.anims.play("right",!0)):(null==(s=this.cursors.up)||!s.isDown||(null==(i=this.cursors.left)?void 0:i.isDown)||(null==(a=this.cursors.right)?void 0:a.isDown))&&!o.up?(null==(r=this.cursors.down)||!r.isDown||(null==(n=this.cursors.left)?void 0:n.isDown)||(null==(l=this.cursors.right)?void 0:l.isDown))&&!o.down?this.player.anims.play("turn"):this.player.anims.play("left",!0):this.player.anims.play("right",!0),(null==(h=this.cursors.up)?void 0:h.isDown)||o.up?u=-d:((null==(p=this.cursors.down)?void 0:p.isDown)||o.down)&&(u=d),this.player.setVelocity(c,u);let y=this.player.body;0!==y.velocity.x&&0!==y.velocity.y&&y.velocity.normalize().scale(d),this.gs.player.x=this.player.x,this.gs.player.y=this.player.y}updateAngryNpc(){if(this.npc&&this.player){let e=new Phaser.Math.Vector2(this.player.x-this.npc.x,this.player.y-this.npc.y).normalize();this.npc.setVelocity(50*e.x,50*e.y)}}respawnAt(e,t){this.gs.player.hp=100,this.player.setPosition(e,t),this.player.body.enable=!0,this.player.setVelocity(0,0),this.gs.player.isPlayerFrozen=!1,this.cameras.main.startFollow(this.player),l.emit("hp:update",this.gs.player.hp),this.player.clearTint()}constructor(){super({key:"rpg"}),i(this,"gs",void 0),i(this,"player",void 0),i(this,"npc",void 0),i(this,"cursors",void 0),i(this,"background",void 0),i(this,"worldLayer",void 0),i(this,"belowLayer",void 0),i(this,"aboveLayer",void 0),i(this,"map",void 0)}}var d=n;class c extends d.default.Scene{init(e){this.ctx=e}create(){let e=this.scale.width,t=this.scale.height;this.backdrop=this.add.rectangle(0,0,e,t,0,.45).setOrigin(0).setScrollFactor(0).setDepth(1e3);let s=Math.min(520,Math.floor(.9*e));this.panel=this.add.rectangle(e/2,t/2,s,220,1118481,.85).setStrokeStyle(2,0xffffff,.22).setDepth(1001).setScrollFactor(0),this.titleTxt=this.add.text(e/2,t/2-110+28,"MODO ESPECTADOR",{fontFamily:"monospace",fontSize:"20px",color:"#ffffff"}).setOrigin(.5,.5).setDepth(1002).setScrollFactor(0),this.spectatable=this.getSpectatableTargets(),0===this.spectatable.length&&(this.spectatable=[]),this.infoTxt=this.add.text(e/2,t/2-12,this.getInfoLine(),{fontFamily:"monospace",fontSize:"16px",color:"#dddddd",wordWrap:{width:s-40},align:"center"}).setOrigin(.5,.5).setDepth(1002).setScrollFactor(0),this.hintTxt=this.add.text(e/2,t/2+18,"← / → troca alvo   •   ENTER: Respawn   •   ESC: Menu",{fontFamily:"monospace",fontSize:"14px",color:"#bbbbbb"}).setOrigin(.5,.5).setDepth(1002).setScrollFactor(0),this.btnRespawn=this.addBtn(e/2-90,t/2+110-36,"[ Respawn ]",()=>{this.handleRespawn()}),this.btnMenu=this.addBtn(e/2+90,t/2+110-36,"[ Voltar ao Menu ]",()=>{this.handleBackToMenu()}),this.input.keyboard.on("keydown-LEFT",()=>this.stepTarget(-1)),this.input.keyboard.on("keydown-RIGHT",()=>this.stepTarget(1)),this.input.keyboard.on("keydown-ENTER",()=>this.handleRespawn()),this.input.keyboard.on("keydown-ESC",()=>this.handleBackToMenu()),this.followCurrentTarget()}addBtn(e,t,s,i){let a=this.add.text(e,t,s,{fontFamily:"monospace",fontSize:"16px",color:"#ffffff",backgroundColor:"#222222",padding:{left:8,right:8,top:4,bottom:4}}).setOrigin(.5,.5).setDepth(1002).setScrollFactor(0).setInteractive({useHandCursor:!0});return a.on("pointerover",()=>a.setStyle({backgroundColor:"#2a2a2a"})),a.on("pointerout",()=>a.setStyle({backgroundColor:"#222222"})),a.on("pointerup",i),a}getSpectatableTargets(){let{main:e}=this.ctx,t=[],s=e.playersGroup;if(s&&s.getChildren().forEach(e=>{e instanceof d.default.GameObjects.Sprite&&e.active&&e.visible&&t.push(e)}),0===t.length&&e.player){let s=e.player;s.active&&s.visible&&t.push(s)}return t}stepTarget(e){0!==this.spectatable.length&&(this.currentIndex=(this.currentIndex+e+this.spectatable.length)%this.spectatable.length,this.followCurrentTarget(),this.refreshInfo())}followCurrentTarget(){if(0===this.spectatable.length)return;let e=this.spectatable[this.currentIndex];this.ctx.main.cameras.main.startFollow(e,!0,.1,.1)}getInfoLine(){if(0===this.spectatable.length)return"Nenhum alvo disponível para espectar.";let e=this.spectatable[this.currentIndex],t=e.name&&e.name.length>0?e.name:"Entidade #".concat(this.currentIndex+1);return"Espectando: ".concat(t,"  (").concat(this.currentIndex+1,"/").concat(this.spectatable.length,")")}refreshInfo(){this.infoTxt.setText(this.getInfoLine())}handleRespawn(){if(this.ctx.main.respawnAt)this.ctx.main.respawnAt(450,300);else{let e=this.ctx.main.player;(null==e?void 0:e.body)&&(e.body.enable=!0,e.setAlpha(1).clearTint().setActive(!0).setVisible(!0).setPosition(100,100),this.ctx.main.cameras.main.startFollow(e),l.emit("hp:update",100))}this.scene.stop()}handleBackToMenu(){this.ctx.main.scene.stop(),this.scene.stop(),this.scene.start("MainGame")}shutdown(){var e;null==(e=this.input.keyboard)||e.removeAllListeners()}constructor(){super({key:"SpectatorUI"}),i(this,"ctx",void 0),i(this,"backdrop",void 0),i(this,"panel",void 0),i(this,"titleTxt",void 0),i(this,"infoTxt",void 0),i(this,"hintTxt",void 0),i(this,"btnRespawn",void 0),i(this,"btnMenu",void 0),i(this,"spectatable",[]),i(this,"currentIndex",0)}}let u={type:Phaser.WEBGL,width:640,height:360,pixelArt:!0,roundPixels:!0,scale:{parent:"game-container",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[p,c],physics:{default:"arcade",arcade:{gravity:{x:0,y:0},fps:120,tileBias:32}}},y=(0,s.forwardRef)(function(e,i){let{currentActiveScene:a,onHpChange:r}=e,o=(0,s.useRef)(null);return(0,s.useRef)({up:!1,down:!1,left:!1,right:!1}),(0,s.useLayoutEffect)(()=>{null===o.current&&(o.current=new n.Game({...u,parent:"game-container"}),"function"==typeof i?i({game:o.current,scene:null}):i&&(i.current={game:o.current,scene:null}));return()=>{o.current&&(o.current.destroy(!0),null!==o.current&&(o.current=null))}},[i]),(0,s.useEffect)(()=>{l.on("current-scene-ready",e=>{a&&"function"==typeof a&&a(e),"function"==typeof i?i({game:o.current,scene:e}):i&&(i.current={game:o.current,scene:e})});let e=e=>{null==r||r(e)};return l.on("hp:update",e),()=>{l.removeListener("current-scene-ready"),l.removeListener("hp:update",e)}},[a,i]),(0,t.jsx)("div",{id:"game-container",className:"w-screen aspect-[16/9] md:w-auto md:h-auto"})}),m={pointerEvents:"auto",borderRadius:"50%",border:"1px solid #ccc",background:"rgba(255,255,255,0.2)",color:"#000",fontSize:"24px",fontWeight:"bold",backdropFilter:"blur(4px)"};function f(){function e(e){return{onMouseDown:()=>{o[e]=!0},onMouseUp:()=>{o[e]=!1},onMouseLeave:()=>{o[e]=!1},onTouchStart:t=>{t.preventDefault(),o[e]=!0},onTouchEnd:t=>{t.preventDefault(),o[e]=!1},onTouchCancel:t=>{t.preventDefault(),o[e]=!1}}}return(0,t.jsxs)("div",{style:{position:"relative",display:"grid",gridTemplateColumns:"60px 60px 60px",gridTemplateRows:"60px 60px 60px",gap:"4px",pointerEvents:"none"},children:[(0,t.jsx)("div",{}),(0,t.jsx)("button",{...e("up"),style:m,children:"↑"}),(0,t.jsx)("div",{}),(0,t.jsx)("button",{...e("left"),style:m,children:"←"}),(0,t.jsx)("div",{}),(0,t.jsx)("button",{...e("right"),style:m,children:"→"}),(0,t.jsx)("div",{}),(0,t.jsx)("button",{...e("down"),style:m,children:"↓"}),(0,t.jsx)("div",{})]})}let g=function(){let[e,i]=(0,s.useState)(!0),[a,r]=(0,s.useState)(100),n=(0,s.useRef)(null);return(0,t.jsxs)("div",{id:"app",children:[(0,t.jsx)(y,{ref:n,currentActiveScene:e=>{i("MainMenu"!==e.scene.key)},onHpChange:r}),(0,t.jsxs)("div",{children:["HP: ",a]}),(0,t.jsx)("div",{className:"block md:hidden",children:(0,t.jsx)(f,{})})]})}},17494,e=>{e.n(e.i(20231))}]);